```{r warning=FALSE, message=FALSE}
rm(list = ls())

# Importation de la base de donn√©es
donnees <- read.csv("~/Desktop/Master 2025-2026/travel_recommendations.csv", stringsAsFactors = FALSE)
View(donnees)

# Fonction g√©n√©ri5que pour poser une question √† l'ulisateur
fonction_question <- function(question, options) {
  cat("\n", question, "\n")
    # Affiche la question 
  for (i in seq_along(options)) {
    cat(i, ":", options[i], "\n")
    #Affiche toutes les options possibles avec un num√©ro pour que l'utilisateur choisisse
  }
  choix <- as.integer(readline(prompt = "Votre choix (num√©ro) : "))
   # R√©cup√®re le choix de l'utilisateur  
  if (is.na(choix) || choix < 1 || choix > length(options)) {
    cat("Choix invalide. Veuillez r√©essayer.\n")
    return(fonction_question(question, options))
    # V√©rifie que le choix est valide (num√©ro entre 1 et nombre d'options)
  }
  return(options[choix])
}

# Fonction principale du jeu
jeu_voyage <- function() {
  cat("Bienvenue dans le jeu de recommandation de destination de voyage !\n")
  
  # D√©finition des modalit√©s possibles pour chaque crit√®re
  category_ordre   <- unique(donnees$category)
  companions_ordre <- unique(donnees$companions)
  mois_ordre <- c("January","February","March","April","May","June",
                  "July","August","September","October","November","December")
  climate_ordre <- unique(donnees$climate)
  crowd_ordre   <- unique(donnees$crowd_level)
  activities_ordre <- unique(donnees$activities)
  
  # Pose des questions √† l'utilisateur et r√©cup√®re ses choix 
  category_choisi <- fonction_question("Quel type de voyage souhaitez-vous faire ?", category_ordre)
  companions_choisi <- fonction_question("Avec qui comptez-vous partir ?", companions_ordre)
  mois_choisi <- fonction_question("Quel mois souhaitez-vous choisir pour votre voyage ?", mois_ordre)
  climate_choisi <- fonction_question("Quel climat pr√©f√©rez-vous pour votre voyage ?", climate_ordre)
  crowd_choisi <- fonction_question("Quel niveau de fr√©quentation touristique √™tes-vous pr√™t(e) √† accepter ?", crowd_ordre)
  activities_choisie <- fonction_question("Quelle activit√© est la plus importante pour vous pendant ce voyage ?", activities_ordre)
  
  # Poids pour chaque crit√®re
  poids <- c(category=3, companions=2, month=2, climate=1, crowd=2, activities=3)
  
  # Calcul du score pour chaque ligne de la base 
  donnees$score <- mapply(function(dest, cat, comp, mois, clim, crowd, act) {
    score <- 0
    # V√©rifie chaque crit√®re et ajoute le poids si la destination correspond au choix de l'utilisateur
    if (any(cat == category_choisi)) score <- score + poids["category"]
    if (any(comp == companions_choisi)) score <- score + poids["companions"]
    if (any(grepl(mois_choisi, mois, ignore.case=TRUE))) score <- score + poids["month"]
    if (any(clim == climate_choisi)) score <- score + poids["climate"]
    if (any(crowd == crowd_choisi)) score <- score + poids["crowd"]
    if (any(act == activities_choisie)) score <- score + poids["activities"]
    return(score)
  }, donnees$destination, donnees$category, donnees$companions, donnees$best_months,
     donnees$climate, donnees$crowd_level, donnees$activities)
  
  # Agr√©ger les scores par destination pour g√©rer les doublons 
  scores <- aggregate(score ~ destination, data=donnees, sum)
  # Si une destination appar√¢it plusieurs fois, on additionne les scores pour obtenir un score global
  
  # Top 3 destinations
  top3 <- head(scores[order(scores$score, decreasing=TRUE),], 3)
  
  # Affichage top 3 avec explication
  cat("\nVoici votre top 3 des destinations :\n")
  for (i in 1:nrow(top3)) {
    dest <- top3$destination[i]
    score <- top3$score[i]
    cat("\n-", dest, "(Score:", score, ")\n")
    
    cat("  Correspondance :")
    if (any(donnees$category[donnees$destination==dest]==category_choisi)) cat(" Type de voyage ‚úÖ")
    if (any(donnees$companions[donnees$destination==dest]==companions_choisi)) cat(", Compagnons ‚úÖ")
    if (any(grepl(mois_choisi, donnees$best_months[donnees$destination==dest], ignore.case=TRUE))) cat(", Mois ‚úÖ")
    if (any(donnees$climate[donnees$destination==dest]==climate_choisi)) cat(", Climat ‚úÖ")
    if (any(donnees$crowd_level[donnees$destination==dest]==crowd_choisi)) cat(", Fr√©quentation ‚úÖ")
    if (any(donnees$activities[donnees$destination==dest]==activities_choisie)) cat(", Activit√© ‚úÖ")
    
    if ("link" %in% colnames(donnees)) {
      cat("\n  Plus d'infos :", donnees$link[donnees$destination==dest])
    }
    cat("\n")
  }
  
  # Destination id√©ale 
  cat("\nVotre destination id√©ale est :", top3$destination[1], "\n")
  cat("Bon voyage ‚úàÔ∏èüåç\n")
  
  # Option : prioriser 2 crit√®res
  cat("\nVoulez-vous prioriser certains crit√®res pour votre destination ?\n")
  cat("1: Non, le top 3 me suffit\n2: Oui, je veux prioriser 2 crit√®res\n")
  choix_priorite <- as.integer(readline(prompt="Votre choix : "))
  
  if (choix_priorite == 2) {
    cat("\nChoisissez deux crit√®res √† respecter absolument :\n")
    cat("1: Type de voyage\n2: Compagnons\n3: Mois\n4: Climat\n5: Niveau de fr√©quentation\n6: Activit√©\n")
    critere1 <- as.integer(readline(prompt="Premier crit√®re : "))
    critere2 <- as.integer(readline(prompt="Deuxi√®me crit√®re : "))
    
    # Fonction pour v√©rifier les crit√®res prioritaires
    respecter_criteres <- function(dest) {
      c1_ok <- if (critere1 == 1) any(donnees$category[donnees$destination==dest]==category_choisi) else
               if (critere1 == 2) any(donnees$companions[donnees$destination==dest]==companions_choisi) else
               if (critere1 == 3) any(grepl(mois_choisi, donnees$best_months[donnees$destination==dest], ignore.case=TRUE)) else
               if (critere1 == 4) any(donnees$climate[donnees$destination==dest]==climate_choisi) else
               if (critere1 == 5) any(donnees$crowd_level[donnees$destination==dest]==crowd_choisi) else
               if (critere1 == 6) any(donnees$activities[donnees$destination==dest]==activities_choisie)
      
      c2_ok <- if (critere2 == 1) any(donnees$category[donnees$destination==dest]==category_choisi) else
               if (critere2 == 2) any(donnees$companions[donnees$destination==dest]==companions_choisi) else
               if (critere2 == 3) any(grepl(mois_choisi, donnees$best_months[donnees$destination==dest], ignore.case=TRUE)) else
               if (critere2 == 4) any(donnees$climate[donnees$destination==dest]==climate_choisi) else
               if (critere2 == 5) any(donnees$crowd_level[donnees$destination==dest]==crowd_choisi) else
               if (critere2 == 6) any(donnees$activities[donnees$destination==dest]==activities_choisie)
      
      return(c1_ok & c2_ok)
    }
    
    destinations_filtrees <- top3$destination[sapply(top3$destination, respecter_criteres)]
    if (length(destinations_filtrees) > 0) {
      cat("\nVotre top 1 respectant vos crit√®res : ", destinations_filtrees[1], "\n")
    } else {
      cat("\nAucune destination ne respecte parfaitement vos crit√®res, voici le top g√©n√©ral.\n")
    }
  }
}

# Lancer le jeu
jeu_voyage()
```
